# MACD（Moving Average Convergence/Divergence,指数平滑移动平均线）

## MACD指标简介

MACD被誉为技术指标之王。

Appel的MACD指标，他的交易理解是：市场的交易是脉冲式的，缩减的脉冲暗示调整近在眼前，而扩张的脉冲暗示市场即将继续上涨。

他类比高尔夫球的运动，抛物线轨迹，从飞行的角度和速度判断落点，而球在上升过程中速度逐步减少，斜率逐渐归零，然后开始下降。

综合，他关注的是动量的变化，是一个短期的趋势指标，缺少对长期和总体的把握。

MACD是一个双均线系统，所以理论上可以追踪长期走势，但他本人没有用这个的描述长期变化的想法。

只是推断，Appel设计指标的初衷，可能只是为了提早的发现金叉和死叉。

MACD技术指标含有三个参数，分别是：
-   短期线（12日EMA）
-   长期线（26日EMA）
-   信号线（9日EMA）

你是否质疑过这三个参数的选择，为什么要选择这么几个奇怪的数值？

都市传说，其中的参数MACD(12,26,9)美国一周六天班，交易六天，12是两周，26是一个月只放四天假，鉴定为假。<font color = '##FFF299'>Appel自己的说法是，纯交易经验。拍脑袋来的</font>，

只是在开发之初，结合自己多年的交易经验，这个参数组合具有更好的表现。

>Appel给了一个建议，“长均线是短均线的2-3倍较好”，短期线的时间跨度越短，则越容易捕捉到短期的价格变化，但是也会增加噪声。信号线DEM的参数建议设置到3-9，他是MACD的移动指数平均线。

>他给了三组建议的参数，分别是(12,26,9)，(5,13,9)，(19,39,9)，其中第一个是最常用的，第二个是短线交易者的选择，第三个是中线交易者的选择。

所以别再傻傻的搬来就用了，参数当然是可以更改的，尽量参考以上的原则做调整就可以了。

## MACD指标计算公式
MACD指标的计算公式如下：
$$DIF = EMA(Close, 12) - EMA(Close, 26)$$
$$DEM = EMA(DIF, 9)$$
$$OSC = DIF - DEM = DIF - MACD，或简写为D-M$$

其中：
-   DIF是一个差值，Close是收盘价。
-   EMA是目标收盘价的移动平均线，n是计算MACD的周期数。通常n取12和26。
-   DEM是DIF的移动平均线，n是计算DEM的周期数。通常n取9。
-   OSC是MACD指标的差值，即DIFF和DEM的差值。

<font color = '#F70'>故MACD指标是由两线一柱组合起来形成，快速线（白色线）为DIF，慢速线【信号线】（黄色线）为DEM，柱状图为MACD。</font>

想理解MACD指标，首先得明白移动平均值计算EMA()的用途。EMA()来源于MA，即移动平均，统计学毕业的人有印象，moving average。加上一个E(exponential)，也就是敲代码的时候计算指数的exp，引入指数的作用在于让越近期的数据加权影响力越重，但比较旧的数据也給予一定的加权值。

加权的程度以排名 α 决定，α 数值介乎 0 至 1。α 也可用天数N来代表：
$$\alpha = \frac{2}{N+1}$$
当N = 1时，权重为1，N=19时，权重为0.1

EMA()的计算公式如下：
$$EMA_t = \alpha * Close_t + (1 - \alpha) * EMA_{t-1}$$
将$$EMA_{t-1}$$循环代入，那么就得到：
$$EMA_t = \alpha *(Close_t + (1 - \alpha) * Close_{t-1} + (1 - \alpha)^2 * Close_{t-2} + (1 - \alpha)^3 * Close_{t-3} + ...)$$

这是一个无穷级数，而$1-\alpha$的指数是不断减小的，可以忽略只计算前（N+1）项，少计算的部分是$(1 - \alpha)^{N+1}$

而根据伯努利的$lim_{n\rightarrow \infty}(1+\frac{x}{n})^n = e^x$，可以得到：$1-(1 - \alpha)^{N+1}$这个值约为86%，即当$\alpha = \frac{2}{N+1}$，前N+1项已覆盖了86%的完整权重。

具体推导过程，详见：[移动平均 - 维基百科](https://zh.wikipedia.org/wiki/%E7%A7%BB%E5%8B%95%E5%B9%B3%E5%9D%87#%E6%8C%87%E6%95%B8%E7%A7%BB%E5%8B%95%E5%B9%B3%E5%9D%87)